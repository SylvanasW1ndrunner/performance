<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>绩效考核系统 - 登录</title>

    <!-- 本地Bootstrap -->
    <link rel="stylesheet" href="{{ url_for('node_modules', filename='bootstrap/dist/css/bootstrap.min.css') }}">

    <!-- 自定义登录样式 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
</head>
<body>
<main class="login-container">
    <!-- 登录卡片 -->
    <div class="login-card shadow">
        <!-- 品牌标识 -->
        <div class="brand-header">
            <img src="{{ url_for('static', filename='img/logo.svg') }}" alt="公司Logo" class="brand-logo">
            <h1 class="brand-title">绩效管理系统</h1>
        </div>

        <!-- 登录表单 -->
        <form id="loginForm" class="needs-validation" novalidate>
            <!-- 用户名输入 -->
            <div class="mb-4 form-group">
                <label for="username" class="form-label">用户名</label>
                <div class="input-group">
                        <span class="input-group-text">
                            <svg class="input-icon" viewBox="0 0 24 24">
                                <path d="M12 2a5 5 0 1 0 5 5 5 5 0 0 0-5-5Zm0 8a3 3 0 1 1 3-3 3 3 0 0 1-3 3Zm9 11v-1a7 7 0 0 0-7-7h-4a7 7 0 0 0-7 7v1h2v-1a5 5 0 0 1 5-5h4a5 5 0 0 1 5 5v1Z"/>
                            </svg>
                        </span>
                    <input type="text"
                           class="form-control"
                           id="username"
                           placeholder="请输入用户名"
                           required>
                    <div class="invalid-feedback">请输入有效的用户名</div>
                </div>
            </div>

            <!-- 密码输入 -->
            <div class="mb-4 form-group">
                <label for="password" class="form-label">密码</label>
                <div class="input-group">
                        <span class="input-group-text">
                            <svg class="input-icon" viewBox="0 0 24 24">
                                <path d="M12 2a5 5 0 1 0 5 5 5 5 0 0 0-5-5Zm0 8a3 3 0 1 1 3-3 3 3 0 0 1-3 3Zm9 11v-1a7 7 0 0 0-7-7h-4a7 7 0 0 0-7 7v1h2v-1a5 5 0 0 1 5-5h4a5 5 0 0 1 5 5v1Z"/>
                            </svg>
                        </span>
                    <input type="password"
                           class="form-control"
                           id="password"
                           placeholder="请输入密码"
                           required>
                    <button type="button"
                            class="btn btn-link password-toggle"
                            onclick="togglePassword()">
                        <svg class="eye-icon" viewBox="0 0 24 24">
                            <path d="M12 4.5C7 4.5 2.7 7.6 1 12c1.7 4.4 6 7.5 11 7.5s9.3-3.1 11-7.5c-1.7-4.4-6-7.5-11-7.5zM12 17c-2.8 0-5-2.2-5-5s2.2-5 5-5 5 2.2 5 5-2.2 5-5 5zm0-8c-1.7 0-3 1.3-3 3s1.3 3 3 3 3-1.3 3-3-1.3-3-3-3z"/>
                        </svg>
                    </button>
                    <div class="invalid-feedback">请输入密码</div>
                </div>
            </div>

            <!-- 操作区 -->
            <div class="d-grid mb-3">
                <button type="submit" class="btn btn-primary btn-lg">登 录</button>
            </div>

            <!-- 辅助链接 -->
            <div class="text-center">
                <a href="#forgot-password" class="text-muted small">忘记密码？</a>
                <span class="text-muted mx-2">|</span>
                <a href="#register" class="text-muted small">注册新账号</a>
            </div>
        </form>
    </div>

    <!-- 错误提示框 -->
    <div class="alert alert-danger alert-dismissible fade" role="alert" id="errorAlert">
        <span id="errorMessage"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
</main>

<!-- 脚本 -->
<script src="{{ url_for('node_modules', filename='bootstrap/dist/css/bootstrap.bundle.min.js') }}"></script>
<script>
    // 密码显示切换
    function togglePassword() {
        const passwordField = document.getElementById('password');
        const eyeIcon = document.querySelector('.eye-icon');
        if (passwordField.type === 'password') {
            passwordField.type = 'text';
            eyeIcon.classList.add('visible');
        } else {
            passwordField.type = 'password';
            eyeIcon.classList.remove('visible');
        }
    }

    // 表单提交处理
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const form = e.target;
        if (!form.checkValidity()) {
            form.classList.add('was-validated');
            return;
        }

        try {
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username: document.getElementById('username').value,
                    password: document.getElementById('password').value
                })
            });

            const data = await response.json();
            if (response.ok) {
                // 登录成功处理
                window.location.href = '/dashboard';
            } else {
                // 显示错误提示
                const errorAlert = document.getElementById('errorAlert');
                document.getElementById('errorMessage').textContent = data.error || '登录失败';
                errorAlert.classList.add('show');
            }
        } catch (error) {
            console.error('登录请求失败:', error);
            document.getElementById('errorMessage').textContent = '网络连接错误';
            document.getElementById('errorAlert').classList.add('show');
        }
    });
</script>
</body>
</html>